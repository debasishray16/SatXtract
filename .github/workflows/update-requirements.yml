name: Update Requirements

on:
  schedule:
    - cron: '0 0 * * *'  # Runs daily at 00:00 UTC. Adjust as needed.
  workflow_dispatch:  # Allows manual triggering

jobs:
  update-requirements:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'  # Or specify your Python version

      - name: Install pip and any other tools
        run: |
          python -m pip install --upgrade pip
          pip install pip-tools # If you use pip-tools

      - name: Update requirements.txt (using pip-tools if available)
        run: |
          if [ -f requirements.in ]; then # Check for requirements.in
            pip-compile --output-file requirements.txt requirements.in
          else
            pip freeze > requirements.txt # Fallback to pip freeze
          fi

      - name: Install updated packages (optional, for testing)
        run: pip install -r requirements.txt

      - name: Commit and Push changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
            commit_message: "chore: Updated requirements.txt"
            file_pattern: requirements.txt
            branch: update-requirements
            create_branch: true
            push_options: '--set-upstream origin update-requirements'
